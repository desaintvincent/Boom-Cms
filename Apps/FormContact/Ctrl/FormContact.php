<?php


namespace Apps\FormContact\Ctrl;


use Boom\Ctrl\Controller;
use Cake\ORM\TableRegistry;

class FormContact extends Controller
{
    function __construct($appname, $request, $response, array $params, $name)
    {
        $this->hasModel = false;
        parent::__construct($appname, $request, $response, $params, $name);
    }

    function action_main($params = null)
    {
        //parent::action_main($params); // TODO: Change the autogenerated stub
        return $this->view('form');
    }

    function action_form($params = null)
    {
        if (isset($_POST['name']) && !empty($_POST['name']) &&
            isset($_POST['email']) && !empty($_POST['email']) &&
            isset($_POST['message']) && !empty($_POST['message'])) {

            $config = TableRegistry::get('FormContact');
            $config = $config->find()->first();

            $name = $_POST['name'];
            $email = $_POST['email'];
            $message = $_POST['message'];
            $destinataire = $config->email;

            $sujet = 'Message depuis kimtan.fr';

            $headers = "From: \"{$name}\"<{$email}>\n";
            $headers .= "Reply-To: {$email}\n";
            $headers .= "Content-Type: text/html; charset=\"iso-8859-1\"";
            if(mail($destinataire, $sujet, $message, $headers))
            {
                return true;
            }
        }
        return false;
    }

}